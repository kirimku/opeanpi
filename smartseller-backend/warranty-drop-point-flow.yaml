openapi: 3.0.3
info:
  title: SmartSeller Warranty Drop Point Flow API
  description: |
    Complete API documentation for warranty claim flow through drop points.
    This covers the entire customer journey from claim submission to barcode replacement.
  version: 1.0.0
  contact:
    name: SmartSeller Team
    email: support@smartseller.com

servers:
  - url: http://localhost:8090/api/v1
    description: Development server
  - url: https://api.smartseller.com/api/v1
    description: Production server

security:
  - BearerAuth: []

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # Common Schemas
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: "Operation failed"
        error:
          type: string
          example: "validation_error"
        error_detail:
          type: string
          example: "Detailed error description"

    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Operation successful"
        data:
          type: object

    # Customer Claim Schemas
    CustomerClaimSubmission:
      type: object
      required:
        - barcode_number
        - claim_type
        - issue_description
        - issue_category
      properties:
        barcode_number:
          type: string
          pattern: '^REX\d{2}[ABCDEFGHJKLMNPQRSTUVWXYZ23456789]{12}$'
          description: "Warranty barcode number in REX format (17 characters)"
          example: "REX25ABCDEF123456"
        claim_type:
          type: string
          enum: [drop_point, direct_shipping]
          description: "Type of claim submission"
          example: "drop_point"
        issue_description:
          type: string
          minLength: 10
          maxLength: 1000
          description: "Detailed description of the issue"
          example: "Screen cracked after accidental drop"
        issue_category:
          type: string
          enum: [screen_damage, battery_issue, water_damage, software_issue, hardware_malfunction, other]
          description: "Category of the issue"
          example: "screen_damage"
        severity:
          type: string
          enum: [low, medium, high, critical]
          default: "medium"
          description: "Severity level of the issue"
        drop_point_details:
          type: object
          required: [drop_point_id]
          properties:
            drop_point_id:
              type: string
              format: uuid
              description: "Drop point ID for claim submission"
              example: "123e4567-e89b-12d3-a456-426614174000"
          description: "Drop point details (required for drop_point claims)"
        shipping_details:
          type: object
          properties:
            pickup_address:
              type: object
              properties:
                street:
                  type: string
                  example: "123 Main St"
                city:
                  type: string
                  example: "Jakarta"
                province:
                  type: string
                  example: "DKI Jakarta"
                postal_code:
                  type: string
                  example: "12345"
                country:
                  type: string
                  example: "Indonesia"
            preferred_pickup_date:
              type: string
              format: date
              description: "Preferred pickup date for shipping"
          description: "Shipping details (required for direct_shipping claims)"
        attachments:
          type: array
          items:
            type: string
            format: binary
          description: "Supporting documents/images"

    WarrantyClaim:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        claim_number:
          type: string
          example: "WC-2023-123456"
        barcode_number:
          type: string
          example: "REX25ABCDEF123456"
        claim_type:
          type: string
          enum: [drop_point, direct_shipping]
        status:
          type: string
          enum: [pending, validated, rejected, in_progress, repaired, replaced, delivered, completed]
        issue_description:
          type: string
        issue_category:
          type: string
        severity:
          type: string
        priority:
          type: string
          enum: [low, normal, high, urgent]
        customer_name:
          type: string
        customer_email:
          type: string
        customer_phone:
          type: string
        drop_point:
          $ref: '#/components/schemas/DropPointInfo'
        pickup_address:
          type: object
        validated_at:
          type: string
          format: date-time
        validated_by:
          type: string
        admin_notes:
          type: string
        replacement_barcode:
          $ref: '#/components/schemas/WarrantyBarcode'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    # Drop Point Schemas
    DropPointInfo:
      type: object
      properties:
        id:
          type: string
          format: uuid
        code:
          type: string
          example: "DP-JKT-001"
        name:
          type: string
          example: "Central Jakarta Drop Point"
        address:
          type: string
        area:
          type: string
        city:
          type: string
        province:
          type: string
        postal_code:
          type: string
        latitude:
          type: number
          format: float
        longitude:
          type: number
          format: float
        drop_point_type:
          type: string
          enum: [retail, service_center, pickup_point, warehouse]
        operating_hours:
          type: array
          items:
            type: object
            properties:
              day:
                type: string
                enum: [monday, tuesday, wednesday, thursday, friday, saturday, sunday]
              is_open:
                type: boolean
              open_time:
                type: string
                pattern: '^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$'
              close_time:
                type: string
                pattern: '^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$'
        contact_info:
          type: object
          properties:
            phone:
              type: string
            email:
              type: string
        capacity_info:
          type: object
          properties:
            maximum_capacity:
              type: integer
              minimum: 1
            current_load:
              type: integer
              minimum: 0
            available_slots:
              type: integer
              minimum: 0
            utilization_rate:
              type: number
              format: float
              minimum: 0
              maximum: 100
        status:
          type: string
          enum: [active, inactive, maintenance]

    # Barcode Schemas
    WarrantyBarcode:
      type: object
      properties:
        id:
          type: string
          format: uuid
        barcode_number:
          type: string
          pattern: '^REX\d{2}[ABCDEFGHJKLMNPQRSTUVWXYZ23456789]{12}$'
          description: "REX format barcode (17 characters total)"
        qr_code_data:
          type: string
        status:
          type: string
          enum: [generated, distributed, waiting_approval, activated, used, expired]
        warranty_period_months:
          type: integer
          minimum: 1
          maximum: 120
        warranty_start_date:
          type: string
          format: date-time
        warranty_end_date:
          type: string
          format: date-time
        customer_id:
          type: string
          format: uuid
        product_info:
          type: object
          properties:
            id:
              type: string
              format: uuid
            name:
              type: string
            sku:
              type: string
        is_replacement:
          type: boolean
        replaced_barcode:
          type: string
          format: uuid
        replacement_reason:
          type: string

    # Admin Validation Schema
    ClaimValidation:
      type: object
      required:
        - validation_notes
        - replacement_cost
      properties:
        validation_notes:
          type: string
          minLength: 10
          maxLength: 500
          description: "Notes from validation process"
          example: "Screen damage verified, customer documentation complete"
        replacement_cost:
          type: number
          format: decimal
          minimum: 0
          description: "Cost of replacement if applicable"
          example: 150.00
        requires_replacement:
          type: boolean
          default: true
        warranty_action:
          type: string
          enum: [carry_over, reset]
          default: "carry_over"
          description: "Warranty action for replacement barcode"
        admin_attachments:
          type: array
          items:
            type: string
            format: binary

    # Replacement Execution Schema
    ReplacementExecution:
      type: object
      required:
        - replacement_barcode_id
        - replacement_notes
      properties:
        replacement_barcode_id:
          type: string
          format: uuid
          description: "ID of the replacement barcode to assign"
        replacement_notes:
          type: string
          minLength: 10
          maxLength: 500
          description: "Notes about the replacement process"
          example: "Original screen replaced with genuine part, functionality verified"
        resolution_type:
          type: string
          enum: [replace, repair, refund]
          default: "replace"
        replacement_date:
          type: string
          format: date-time
        handed_to_customer:
          type: boolean
          default: false

paths:
  # Customer Claim Endpoints
  /storefront/{slug}/claims/submit:
    post:
      tags:
        - Customer Warranty Claims
      summary: Submit a new warranty claim
      description: |
        Submit a new warranty claim either for drop point pickup or direct shipping.
        Supports barcode validation and automatic customer association.
      security:
        - BearerAuth: []
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
          description: "Storefront slug"
        - name: claim
          in: body
          required: true
          schema:
            $ref: '#/components/schemas/CustomerClaimSubmission'
      responses:
        '201':
          description: "Claim submitted successfully"
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/WarrantyClaim'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: "Barcode or drop point not found"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /storefront/{slug}/claims:
    get:
      tags:
        - Customer Warranty Claims
      summary: List customer claims
      description: |
        Retrieve all warranty claims for the authenticated customer.
        Supports filtering by status and date range.
      security:
        - BearerAuth: []
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, validated, rejected, in_progress, repaired, replaced, delivered, completed]
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: "Claims retrieved successfully"
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          claims:
                            type: array
                            items:
                              $ref: '#/components/schemas/WarrantyClaim'
                          pagination:
                            $ref: '#/components/schemas/PaginationInfo'

  /storefront/{slug}/claims/{id}:
    get:
      tags:
        - Customer Warranty Claims
      summary: Get claim details
      description: Retrieve detailed information about a specific warranty claim.
      security:
        - BearerAuth: []
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: "Claim details retrieved"
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/WarrantyClaim'
        '404':
          $ref: '#/components/responses/NotFound'

  /storefront/{slug}/claims/{id}/timeline:
    get:
      tags:
        - Customer Warranty Claims
      summary: Get claim timeline
      description: Retrieve the complete timeline of events for a warranty claim.
      security:
        - BearerAuth: []
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: "Timeline retrieved"
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          timeline:
                            type: array
                            items:
                              $ref: '#/components/schemas/TimelineEntry'

  # Drop Point Admin Endpoints
  /storefront/{slug}/drop-points/claims:
    get:
      tags:
        - Drop Point Admin
      summary: List assigned claims
      description: |
        Retrieve all warranty claims assigned to the drop point admin.
        Filters by drop point and shows pending validations.
      security:
        - BearerAuth: []
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, validated, rejected]
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: "Claims retrieved"
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          claims:
                            type: array
                            items:
                              $ref: '#/components/schemas/WarrantyClaim'
                          drop_point:
                            $ref: '#/components/schemas/DropPointInfo'

  /storefront/{slug}/drop-points/claims/{id}/validate:
    post:
      tags:
        - Drop Point Admin
      summary: Validate warranty claim
      description: |
        Validate a warranty claim and optionally generate a replacement barcode.
        This transitions the claim from 'pending' to 'validated'.
      security:
        - BearerAuth: []
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: validation
          in: body
          required: true
          schema:
            $ref: '#/components/schemas/ClaimValidation'
      responses:
        '200':
          description: "Claim validated successfully"
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          claim:
                            $ref: '#/components/schemas/WarrantyClaim'
                          replacement_barcode:
                            $ref: '#/components/schemas/WarrantyBarcode'

  /storefront/{slug}/drop-points/claims/{id}/reject:
    post:
      tags:
        - Drop Point Admin
      summary: Reject warranty claim
      description: |
        Reject a warranty claim with specified reason.
        This transitions the claim to 'rejected' status.
      security:
        - BearerAuth: []
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: rejection
          in: body
          required: true
          schema:
            type: object
            required:
              - rejection_reason
            properties:
              rejection_reason:
                type: string
                minLength: 10
                maxLength: 500
                example: "Claim rejected: Warranty period expired"
              admin_notes:
                type: string
                maxLength: 1000
      responses:
        '200':
          description: "Claim rejected"
        '400':
          $ref: '#/components/responses/BadRequest'

  /storefront/{slug}/drop-points/claims/{id}/generate-replacement:
    post:
      tags:
        - Drop Point Admin
      summary: Generate replacement barcode
      description: |
        Generate a new replacement barcode for a validated claim.
        Supports both warranty carry-over and reset options.
      security:
        - BearerAuth: []
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: replacement
          in: body
          schema:
            type: object
            properties:
              warranty_action:
                type: string
                enum: [carry_over, reset]
                default: "carry_over"
                description: |
                  carry_over: Preserves remaining warranty period
                  reset: Starts fresh warranty period
              warranty_extension_months:
                type: integer
                minimum: 0
                maximum: 12
                default: 0
                description: "Additional months to add to warranty (carry_over only)"
      responses:
        '201':
          description: "Replacement barcode generated"
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/WarrantyBarcode'

  /storefront/{slug}/drop-points/claims/{id}/execute-replacement:
    post:
      tags:
        - Drop Point Admin
      summary: Execute barcode replacement
      description: |
        Execute the actual replacement by assigning the new barcode.
        This completes the claim and marks it as 'replaced'.
      security:
        - BearerAuth: []
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: execution
          in: body
          required: true
          schema:
            $ref: '#/components/schemas/ReplacementExecution'
      responses:
        '200':
          description: "Replacement executed"
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          claim:
                            $ref: '#/components/schemas/WarrantyClaim'
                          replacement_record:
                            type: object
                            properties:
                              old_barcode:
                                type: string
                              new_barcode:
                                type: string
                              replacement_date:
                                type: string
                                format: date-time

  # Supporting Schemas
  TimelineEntry:
    type: object
    properties:
      id:
        type: string
        format: uuid
      claim_id:
        type: string
        format: uuid
      event_type:
        type: string
        enum: [claim_submitted, validated, rejected, in_progress, repaired, replaced, delivered]
      title:
        type: string
      description:
        type: string
      created_by:
        type: string
      created_at:
        type: string
        format: date-time
      metadata:
        type: object

  PaginationInfo:
    type: object
    properties:
      current_page:
        type: integer
      total_pages:
        type: integer
      total_items:
        type: integer
      items_per_page:
        type: integer
      has_next:
        type: boolean
      has_prev:
        type: boolean

  # Standard Responses
  responses:
    BadRequest:
      description: "Bad Request"
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    Unauthorized:
      description: "Unauthorized"
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    NotFound:
      description: "Resource Not Found"
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    InternalServerError:
      description: "Internal Server Error"
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'