openapi: 3.1.0
info:
  title: Kirimku B2B API
  description: |
    **Kirimku B2B API** provides comprehensive logistics and shipping services for business-to-business integrations.
    
    ## Features
    - **Multi-Courier Integration**: JNT, SiCepat, SAPX, Anteraja, Lion Parcel
    - **Real-time Tariff Calculation**: Get accurate shipping costs instantly
    - **Automated Booking**: Create shipments programmatically
    - **Payment Integration**: Multiple payment methods via DurianPay
    - **Live Tracking**: Real-time shipment tracking across all couriers
    - **Webhook Support**: Real-time notifications for status updates
    
    ## Authentication
    This API uses API Key authentication. Include your API key in the `X-API-Key` header:
    ```
    X-API-Key: your_api_key_here
    ```
    
    ## Rate Limiting
    - **Basic Tier**: 1,000 requests/hour
    - **Business Tier**: 10,000 requests/hour  
    - **Enterprise Tier**: 100,000 requests/hour
    
    Rate limit information is included in response headers:
    - `X-RateLimit-Remaining`: Requests remaining in current window
    - `X-RateLimit-Reset`: Unix timestamp when rate limit resets
    
    ## Webhooks
    Configure webhook endpoints to receive real-time updates for:
    - Booking confirmations
    - Payment status changes
    - Tracking updates
    - Delivery confirmations
    
  version: 1.0.0
  contact:
    name: Kirimku API Support
    email: api-support@kirimku.com
    url: https://docs.kirimku.com
  license:
    name: Proprietary
    url: https://kirimku.com/terms

servers:
  - url: https://api.kirimku.com/api/b2b/v1
    description: Production server
  - url: https://staging-api.kirimku.com/api/b2b/v1
    description: Staging server

security:
  - ApiKeyAuth: []

paths:
  # Location Services
  /locations/provinces:
    get:
      summary: Get all provinces
      description: Retrieve list of all provinces supported by Kirimku
      tags:
        - Location Services
      responses:
        '200':
          description: List of provinces retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LocationResponse'
              example:
                success: true
                data:
                  provinces:
                    - id: "11"
                      name: "DKI Jakarta"
                      code: "JKT"
                    - id: "32"
                      name: "Jawa Barat"
                      code: "JB"
                meta:
                  request_id: "req_123456789"
                  timestamp: "2024-01-15T10:30:00Z"
                  rate_limit:
                    remaining: 999
                    reset_at: "2024-01-15T11:00:00Z"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

  /locations/cities/{province_id}:
    get:
      summary: Get cities by province
      description: Retrieve all cities within a specific province
      tags:
        - Location Services
      parameters:
        - name: province_id
          in: path
          required: true
          description: Province ID
          schema:
            type: string
            example: "11"
      responses:
        '200':
          description: Cities retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CitiesResponse'
        '404':
          $ref: '#/components/responses/NotFound'

  /locations/areas/{city_id}:
    get:
      summary: Get areas by city
      description: Retrieve all areas/districts within a specific city
      tags:
        - Location Services
      parameters:
        - name: city_id
          in: path
          required: true
          description: City ID
          schema:
            type: string
            example: "1101"
      responses:
        '200':
          description: Areas retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AreasResponse'

  /b2b/search-location:
    post:
      summary: Search location by district, postal code, city, or kelurahan
      description: |
        Search for location data by providing a district name, postal code, city name, or kelurahan name. 
        Returns flattened location hierarchy including province, city, district, postal code, and kelurahan list.
        
        **Search Capabilities:**
        - **District Search**: Search by district name (e.g., "Coblong", "Cob")
        - **Postal Code Search**: Search by postal code (e.g., "40131", "4013")
        - **City Search**: Search by city name (e.g., "Bandung", "Band")
        - **Kelurahan Search**: Search by kelurahan/village name (e.g., "Dago", "Lebak Siliwangi")
        
        **Features:**
        - Partial matching supported (e.g., "Cob" will match "Coblong")
        - Case-insensitive search
        - Returns all matching locations with complete hierarchy
        - Each result includes list of kelurahan for the postal code
        
        **Authentication:**
        - Requires valid B2B API key in X-API-Key header
        - Subject to rate limiting based on your B2B tier
        
        **Examples:**
        - Search by district: `{"query": "Coblong"}` → Returns all postal codes in Coblong
        - Search by postal code: `{"query": "40131"}` → Returns location details for 40131
        - Search by city: `{"query": "Bandung"}` → Returns all locations in Bandung
        - Search by kelurahan: `{"query": "Dago"}` → Returns postal codes containing Dago kelurahan
      tags:
        - Location Services
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                query:
                  type: string
                  description: District name, postal code, city name, or kelurahan name to search for
                  example: "Coblong"
                  minLength: 1
                  maxLength: 100
              required:
                - query
            examples:
              searchByDistrict:
                summary: Search by district name
                value:
                  query: "Coblong"
              searchByPostalCode:
                summary: Search by postal code
                value:
                  query: "40131"
              searchByCity:
                summary: Search by city name
                value:
                  query: "Bandung"
              searchByKelurahan:
                summary: Search by kelurahan name
                value:
                  query: "Dago"
              partialSearch:
                summary: Partial search example
                value:
                  query: "Cob"
      responses:
        '200':
          description: Search results with location hierarchy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/B2BLocationSearchResponse'
              example:
                success: true
                message: "Locations retrieved successfully"
                data:
                  - province: "Jawa Barat"
                    city: "Bandung"
                    district: "Coblong"
                    postal_code: "40131"
                    kelurahan: ["Dago", "Lebak Siliwangi", "Sadang Serang", "Sekeloa"]
                  - province: "Jawa Barat"
                    city: "Bandung"
                    district: "Coblong"
                    postal_code: "40132"
                    kelurahan: ["Cipaganti", "Pasteur"]
                meta:
                  request_id: "req_123456789"
                  timestamp: "2024-01-15T10:30:00Z"
                  rate_limit:
                    remaining: 999
                    reset_at: "2024-01-15T11:00:00Z"
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/ServerError'

  # Tariff & Pricing Services
  /tariffs/calculate:
    post:
      summary: Calculate shipping tariffs
      description: |
        Calculate shipping costs across all available couriers for a specific route and package.
        
        **Features:**
        - Multi-courier comparison
        - Real-time pricing
        - Insurance calculation
        - Estimated delivery time
        - Service type options (regular, express, same-day)
      tags:
        - Tariff & Pricing
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TariffCalculationRequest'
            example:
              origin:
                province_id: "11"
                city_id: "1101"
                area_id: "110101"
                postal_code: "10110"
              destination:
                province_id: "32"
                city_id: "3201"
                area_id: "320101"
                postal_code: "40111"
              package:
                weight: 1.5
                length: 20
                width: 15
                height: 10
                value: 500000
                category: "electronics"
              options:
                insurance: true
                cod: false
                express_only: false
      responses:
        '200':
          description: Tariff calculation successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TariffCalculationResponse'
              example:
                success: true
                data:
                  calculation_id: "calc_123456789"
                  origin:
                    province: "DKI Jakarta"
                    city: "Jakarta Pusat"
                    area: "Gambir"
                  destination:
                    province: "Jawa Barat"
                    city: "Bandung"
                    area: "Bandung Wetan"
                  package:
                    weight: 1.5
                    dimensions: "20x15x10 cm"
                    value: 500000
                  couriers:
                    - courier_id: "jnt"
                      courier_name: "J&T Express"
                      services:
                        - service_id: "jnt_reg"
                          service_name: "Regular"
                          price: 12000
                          estimated_delivery: "2-3 days"
                          features: ["tracking", "pickup"]
                          insurance:
                            available: true
                            fee: 2500
                            coverage: 500000
                    - courier_id: "sicepat"
                      courier_name: "SiCepat"
                      services:
                        - service_id: "sicepat_reg"
                          service_name: "Regular"
                          price: 11500
                          estimated_delivery: "2-4 days"
                          features: ["tracking"]
                meta:
                  request_id: "req_123456789"
                  timestamp: "2024-01-15T10:30:00Z"
                  expires_at: "2024-01-15T11:30:00Z"
        '400':
          $ref: '#/components/responses/BadRequest'

  /couriers:
    get:
      summary: Get available couriers with pricing
      description: |
        Retrieve available courier services with real-time pricing for a specific route and package.
        
        **Features:**
        - Multi-courier comparison (JNT, SiCepat, SAPX, Anteraja, Lion Parcel, JNE)
        - Real-time pricing calculation
        - Service availability checking
        - COD (Cash on Delivery) support
        - Package category-based recommendations
        - Coordinate-based routing (optional)
        
        **Note:** This endpoint requires origin and destination details to calculate accurate pricing.
        For B2B clients, cashback information is not included in the response.
      tags:
        - Courier Services
      parameters:
        - name: from_city
          in: query
          required: true
          description: Origin city name
          schema:
            type: string
          example: "Jakarta Pusat"
        - name: from_district
          in: query
          required: true
          description: Origin district name
          schema:
            type: string
          example: "Gambir"
        - name: to_city
          in: query
          required: true
          description: Destination city name
          schema:
            type: string
          example: "Bandung"
        - name: to_district
          in: query
          required: true
          description: Destination district name
          schema:
            type: string
          example: "Bandung Wetan"
        - name: weight
          in: query
          required: true
          description: Package weight in grams
          schema:
            type: integer
            minimum: 1
          example: 1000
        - name: length
          in: query
          description: Package length in centimeters
          schema:
            type: integer
          example: 20
        - name: width
          in: query
          description: Package width in centimeters
          schema:
            type: integer
          example: 15
        - name: height
          in: query
          description: Package height in centimeters
          schema:
            type: integer
          example: 10
        - name: from_province
          in: query
          description: Origin province name
          schema:
            type: string
          example: "DKI Jakarta"
        - name: to_province
          in: query
          description: Destination province name
          schema:
            type: string
          example: "Jawa Barat"
        - name: from_latitude
          in: query
          description: Origin latitude for coordinate-based routing
          schema:
            type: number
            format: double
          example: -6.2088
        - name: from_longitude
          in: query
          description: Origin longitude for coordinate-based routing
          schema:
            type: number
            format: double
          example: 106.8456
        - name: to_latitude
          in: query
          description: Destination latitude for coordinate-based routing
          schema:
            type: number
            format: double
          example: -6.9175
        - name: to_longitude
          in: query
          description: Destination longitude for coordinate-based routing
          schema:
            type: number
            format: double
          example: 107.6191
        - name: service_type
          in: query
          description: Filter by specific service type
          schema:
            type: string
          example: "REG"
        - name: service_name
          in: query
          description: Filter by specific service name
          schema:
            type: string
          example: "JNE REG"
        - name: cod
          in: query
          description: Enable Cash on Delivery option
          schema:
            type: boolean
            default: false
        - name: order_price
          in: query
          description: Order value in IDR (required for COD calculations)
          schema:
            type: integer
          example: 100000
        - name: package_category
          in: query
          description: Package category for insurance recommendations
          schema:
            type: string
            enum: [electronics, clothing, food, documents, fragile, other]
          example: "electronics"
        - name: show_all
          in: query
          description: Show all available services including unavailable ones
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Couriers retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/B2BCourierResponse'
              example:
                success: true
                message: "Couriers retrieved successfully"
                data:
                  couriers:
                    - id: "jnt"
                      name: "J&T Express"
                      code: "jnt"
                      logo_url: "https://cdn.kirimku.com/logos/jnt.png"
                      services:
                        - service_id: "jnt_reg"
                          service_name: "J&T Regular"
                          service_type: "REG"
                          description: "Regular delivery service"
                          price: 12000
                          estimated_time: "2-3 hari"
                          type: "regular"
                          courier_service_type: "REG"
                          courier_id: "jnt"
                          availability: true
                          features: ["tracking", "insurance"]
                          is_cod_available: true
                          min_weight: 1
                          max_weight: 30000
                    - id: "sicepat"
                      name: "SiCepat"
                      code: "sicepat"
                      logo_url: "https://cdn.kirimku.com/logos/sicepat.png"
                      services:
                        - service_id: "sicepat_reg"
                          service_name: "SiCepat Regular"
                          service_type: "REG"
                          description: "Regular delivery service"
                          price: 11000
                          estimated_time: "1-2 hari"
                          type: "regular"
                          courier_service_type: "REG"
                          courier_id: "sicepat"
                          availability: true
                          features: ["tracking", "insurance"]
                          is_cod_available: true
                          min_weight: 1
                          max_weight: 50000
        '400':
          description: Invalid query parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missing_required:
                  summary: Missing required parameters
                  value:
                    success: false
                    message: "Invalid query parameters"
                    error: "bad_request"
                    meta:
                      details: "FromDistrict and ToDistrict are required fields"
                invalid_weight:
                  summary: Invalid weight value
                  value:
                    success: false
                    message: "Invalid query parameters"
                    error: "bad_request"
                    meta:
                      details: "Weight must be greater than 0"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Failed to retrieve couriers"
                error: "internal_server_error"

  # Booking Management
  /bookings:
    post:
      summary: Create new booking
      description: |
        Create a new shipment booking with the selected courier and service.
        
        **Process:**
        1. Validate addresses and package details
        2. Automatically map area_id to province, city, and district names
        3. Create booking with selected courier
        4. Generate tracking number
        5. Process payment based on payment_method
        6. Return booking confirmation with payment details (if applicable)
        
        **Payment Methods:**
        - `API_CREDIT` (default): Uses B2B account credit, no additional payment required
        - `QRCODE`: Generates QR code for QRIS payments, returns invoice with QR data
        - `VA`: Generates virtual account for bank transfers
        - `EWALLET`: Generates e-wallet payment links
        
        **Response Structure:**
        - For `API_CREDIT`: Returns booking data only
        - For other payment methods: Returns booking + transaction + invoice with payment details
        
        **Address Mapping:**
        The system automatically populates location details (province, city, district) based on the provided `area_id` in sender and recipient addresses. Use the `/b2b/search-location` endpoint to find the correct area_id for your locations.
      tags:
        - Booking Management
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransactionCreateRequest'
            example:
              unique_id: "trans-b2b-123456"
              order_name: "Electronics - Laptop"
              order_price: 500000
              weight: 1500
              length: 20
              width: 15
              height: 10
              notes: "Fragile items, handle with care"
              courier: "jnt"
              courier_service_type: "REG"
              pickup_method: "pickup"
              platform: "web"
              with_insurance: true
              cod: false
              package_category: "Fashion"
              payment_method: "QRCODE"
              channel: "QRIS"
              from:
                name: "PT. Example Company"
                phone: "628123456789"
                email: "sender@example.com"
                address: "Jl. Sudirman No. 123, Gedung A, Lantai 5"
                area: "Gambir"
                city: "Jakarta Pusat"
                province: "DKI Jakarta"
                post_code: "10110"
              to:
                name: "John Doe"
                phone: "628987654321"
                email: "recipient@example.com"
                address: "Jl. Asia Afrika No. 456, Rumah cat biru"
                area: "Andir"
                city: "Bandung"
                province: "Jawa Barat"
                post_code: "40111"
      responses:
        '201':
          description: Booking created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookingResponse'
              example:
                success: true
                message: "Booking created successfully"
                data:
                  booking:
                    id: "550e8400-e29b-41d4-a716-446655440000"
                    booking_id: "BKG-20240115-001"
                    tracking_number: "JT123456789"
                    courier_id: "jnt"
                    courier_name: "J&T Express"
                    service_id: "REG"
                    service_name: "Regular"
                    status: "confirmed"
                    total_cost: 14500
                    shipping_cost: 12000
                    insurance_cost: 2500
                    cod_amount: 0
                    estimated_pickup: "2024-01-16T09:00:00Z"
                    estimated_delivery: "2024-01-18T17:00:00Z"
                    created_at: "2024-01-15T10:30:00Z"
                  transaction:
                    id: "TXN-20240115-001"
                    transaction_code: "TXN-20240115-001"
                    amount: 14500
                    status: "pending"
                    payment_method: "QRCODE"
                    channel: "QRIS"
                    created_at: "2024-01-15T10:30:00Z"
                  invoice:
                    id: "INV-2024-001"
                    invoice_url: "https://payment.example.com/invoice/INV-2024-001"
                    qr_code: "00020101021226..."
                    amount: 14500
                    status: "pending"
                    expires_at: "2024-01-15T22:30:00Z"
                    created_at: "2024-01-15T10:30:00Z"
                meta:
                  request_id: "req_123456789"
                  timestamp: "2024-01-15T10:30:00Z"

  /bookings/{booking_id}:
    get:
      summary: Get booking details
      description: Retrieve detailed information about a specific booking
      tags:
        - Booking Management
      parameters:
        - name: booking_id
          in: path
          required: true
          description: Booking ID
          schema:
            type: string
            example: "BKG-20240115-001"
      responses:
        '200':
          description: Booking details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookingDetailsResponse'

    put:
      summary: Update booking
      description: Update booking details (limited fields after confirmation)
      tags:
        - Booking Management
      parameters:
        - name: booking_id
          in: path
          required: true
          description: Booking ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookingUpdateRequest'
      responses:
        '200':
          description: Booking updated successfully

  /bookings/{booking_id}/cancel:
    put:
      summary: Cancel booking
      description: Cancel a booking (only allowed before pickup)
      tags:
        - Booking Management
      parameters:
        - name: booking_id
          in: path
          required: true
          description: Booking ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
                  description: Cancellation reason
                  example: "Customer request"
      responses:
        '200':
          description: Booking cancelled successfully

  # Transaction Management
  /transactions/{transaction_id}:
    get:
      summary: Get transaction details
      description: |
        Retrieve detailed information about a specific transaction.
        
        **Access Control:**
        - B2B clients can only access transactions they created
        - Returns comprehensive transaction information including status, tracking, and payment details
      tags:
        - Transaction Management
      parameters:
        - name: transaction_id
          in: path
          required: true
          description: Transaction ID
          schema:
            type: string
            example: "TXN-20240115-001"
      responses:
        '200':
          description: Transaction details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransactionResponse'
              example:
                success: true
                data:
                  id: "TXN-20240115-001"
                  unique_id: "trans-b2b-123456"
                  order_name: "Electronics - Laptop"
                  order_price: 500000
                  weight: 1500
                  dimensions:
                    length: 20
                    width: 15
                    height: 10
                  notes: "Fragile items, handle with care"
                  courier: "jnt"
                  courier_service_type: "REG"
                  pickup_method: "pickup"
                  platform: "web"
                  with_insurance: true
                  cod: false
                  package_category: "Fashion"
                  status: "confirmed"
                  tracking_number: "JT123456789"
                  total_cost: 14500
                  breakdown:
                    shipping_fee: 12000
                    insurance_fee: 2500
                    admin_fee: 0
                  payment:
                    status: "paid"
                    method: "api_credit"
                    invoice_id: "INV-2024-001"
                  sender:
                    name: "PT. Example Company"
                    phone: "628123456789"
                    email: "sender@example.com"
                    address: "Jl. Sudirman No. 123, Gedung A, Lantai 5"
                    area: "Gambir"
                    city: "Jakarta Pusat"
                    province: "DKI Jakarta"
                    post_code: "10110"
                  recipient:
                    name: "John Doe"
                    phone: "628987654321"
                    email: "recipient@example.com"
                    address: "Jl. Asia Afrika No. 456, Rumah cat biru"
                    area: "Andir"
                    city: "Bandung"
                    province: "Jawa Barat"
                    post_code: "40111"
                  estimated_pickup: "2024-01-16T09:00:00Z"
                  estimated_delivery: "2024-01-18T17:00:00Z"
                  created_at: "2024-01-15T10:30:00Z"
                  updated_at: "2024-01-15T10:30:00Z"
                meta:
                  request_id: "req_123456789"
                  timestamp: "2024-01-15T10:30:00Z"
        '404':
          description: Transaction not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Transaction not found"
                error: "not_found"
                meta:
                  request_id: "req_123456789"
                  timestamp: "2024-01-15T10:30:00Z"
        '403':
          description: Access denied - transaction belongs to another client
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Access denied"
                error: "forbidden"
                meta:
                  request_id: "req_123456789"
                  timestamp: "2024-01-15T10:30:00Z"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /invoices/{invoice_id}:
    get:
      summary: Get invoice details
      description: |
        Retrieve detailed information about a specific invoice.
        
        **Access Control:**
        - B2B clients can only access invoices they own
        - Returns comprehensive invoice information including payment status, transactions, and breakdown
        - Supports both single invoices and consolidated invoices
      tags:
        - Transaction Management
      parameters:
        - name: invoice_id
          in: path
          required: true
          description: Invoice ID
          schema:
            type: string
            example: "INV-2024-001"
      responses:
        '200':
          description: Invoice details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvoiceResponse'
              example:
                success: true
                data:
                  id: "INV-2024-001"
                  type: "single"
                  status: "paid"
                  amount: 14500
                  currency: "IDR"
                  payment_method: "api_credit"
                  payment_date: "2024-01-15T11:00:00Z"
                  due_date: "2024-01-22T23:59:59Z"
                  transaction_ids: ["TXN-20240115-001"]
                  breakdown:
                    shipping_fee: 12000
                    insurance_fee: 2500
                    admin_fee: 0
                    total: 14500
                  client:
                    id: "client_123"
                    name: "PT. Example Company"
                  created_at: "2024-01-15T10:30:00Z"
                  updated_at: "2024-01-15T11:00:00Z"
                meta:
                  request_id: "req_123456789"
                  timestamp: "2024-01-15T10:30:00Z"
        '404':
          description: Invoice not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Invoice not found"
                error: "not_found"
                meta:
                  request_id: "req_123456789"
                  timestamp: "2024-01-15T10:30:00Z"
        '403':
          description: Access denied - invoice belongs to another client
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Access denied"
                error: "forbidden"
                meta:
                  request_id: "req_123456789"
                  timestamp: "2024-01-15T10:30:00Z"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # Payment Services
  /payments/invoices:
    post:
      summary: Create payment invoice
      description: Create a payment invoice for one or multiple bookings
      tags:
        - Payment Services
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentInvoiceRequest'
      responses:
        '201':
          description: Payment invoice created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentInvoiceResponse'

  /payments/{payment_id}/status:
    get:
      summary: Get payment status
      description: Check the current status of a payment
      tags:
        - Payment Services
      parameters:
        - name: payment_id
          in: path
          required: true
          description: Payment ID
          schema:
            type: string
      responses:
        '200':
          description: Payment status retrieved successfully

  # Tracking Services
  /tracking/{tracking_number}:
    get:
      summary: Track shipment
      description: Get real-time tracking information for a shipment
      tags:
        - Tracking Services
      parameters:
        - name: tracking_number
          in: path
          required: true
          description: Tracking number
          schema:
            type: string
            example: "JT123456789"
      responses:
        '200':
          description: Tracking information retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TrackingResponse'
              example:
                success: true
                data:
                  tracking_number: "JT123456789"
                  courier: "jnt"
                  status: "in_transit"
                  current_location: "Jakarta Hub"
                  estimated_delivery: "2024-01-18T17:00:00Z"
                  last_update: "2024-01-16T14:30:00Z"
                  history:
                    - timestamp: "2024-01-15T10:30:00Z"
                      status: "picked_up"
                      location: "Jakarta Pusat"
                      description: "Package picked up from sender"
                    - timestamp: "2024-01-16T08:00:00Z"
                      status: "in_transit"
                      location: "Jakarta Hub"
                      description: "Package arrived at sorting facility"
                    - timestamp: "2024-01-16T14:30:00Z"
                      status: "in_transit"
                      location: "Jakarta Hub"
                      description: "Package departed from Jakarta Hub"

  /tracking/batch:
    post:
      summary: Track multiple shipments
      description: Get tracking information for multiple shipments in a single request
      tags:
        - Tracking Services
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                tracking_numbers:
                  type: array
                  items:
                    type: string
                  maxItems: 50
                  example: ["JT123456789", "SP987654321", "SAP456789123"]
      responses:
        '200':
          description: Batch tracking information retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchTrackingResponse'

  # Webhook Management
  /webhooks:
    post:
      summary: Register webhook endpoint
      description: Register a webhook URL to receive real-time notifications
      tags:
        - Webhook Management
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WebhookRegistrationRequest'
      responses:
        '201':
          description: Webhook registered successfully

    get:
      summary: List webhook endpoints
      description: Get list of registered webhook endpoints
      tags:
        - Webhook Management
      responses:
        '200':
          description: Webhook endpoints retrieved successfully

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key for authentication

  schemas:
    # Base Response Schemas
    BaseResponse:
      type: object
      properties:
        success:
          type: boolean
        meta:
          $ref: '#/components/schemas/ResponseMeta'
        errors:
          type: array
          items:
            $ref: '#/components/schemas/ErrorDetail'

    ResponseMeta:
      type: object
      properties:
        request_id:
          type: string
          description: Unique request identifier
        timestamp:
          type: string
          format: date-time
          description: Response timestamp
        rate_limit:
          $ref: '#/components/schemas/RateLimitInfo'

    RateLimitInfo:
      type: object
      properties:
        remaining:
          type: integer
          description: Requests remaining in current window
        reset_at:
          type: string
          format: date-time
          description: When rate limit resets

    ErrorDetail:
      type: object
      properties:
        code:
          type: string
          description: Error code
        message:
          type: string
          description: Human-readable error message
        field:
          type: string
          description: Field that caused the error (if applicable)

    # Location Schemas
    LocationResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                provinces:
                  type: array
                  items:
                    $ref: '#/components/schemas/Province'

    Province:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        code:
          type: string

    CitiesResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                cities:
                  type: array
                  items:
                    $ref: '#/components/schemas/City'

    City:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        province_id:
          type: string

    AreasResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                areas:
                  type: array
                  items:
                    $ref: '#/components/schemas/Area'

    Area:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        city_id:
          type: string
        postal_code:
          type: string

    B2BLocationSearchResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            message:
              type: string
              description: Response message
              example: "Locations retrieved successfully"
            data:
              type: array
              items:
                $ref: '#/components/schemas/B2BLocationResult'

    B2BLocationResult:
      type: object
      properties:
        province:
          type: string
          description: Province name
          example: "Jawa Barat"
        city:
          type: string
          description: City name
          example: "Bandung"
        district:
          type: string
          description: District name
          example: "Coblong"
        postal_code:
          type: string
          description: Postal code
          example: "40131"
        kelurahan:
          type: array
          items:
            type: string
          description: List of kelurahan/villages in this postal code
          example: ["Dago", "Lebak Siliwangi", "Sadang Serang", "Sekeloa"]

    # Courier Schemas
    B2BCourierResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            message:
              type: string
              description: Response message
              example: "Couriers retrieved successfully"
            data:
              type: array
              items:
                $ref: '#/components/schemas/CourierOption'

    CourierOption:
      type: object
      properties:
        courier_id:
          type: string
          description: Unique courier identifier
          example: "jne"
        courier_name:
          type: string
          description: Courier company name
          example: "JNE"
        service_code:
          type: string
          description: Service type code
          example: "REG"
        service_name:
          type: string
          description: Service type name
          example: "Regular"
        service_description:
          type: string
          description: Detailed service description
          example: "Regular delivery service"
        cost:
          type: integer
          description: Shipping cost in IDR
          example: 15000
        estimated_delivery:
          type: string
          description: Estimated delivery time
          example: "2-3 hari kerja"
        cod_available:
          type: boolean
          description: Whether Cash on Delivery is available
          example: true
        insurance_available:
          type: boolean
          description: Whether insurance is available
          example: true
        max_weight:
          type: number
          format: float
          description: Maximum weight allowed in kg
          example: 30.0
        max_dimensions:
          type: object
          properties:
            length:
              type: number
              format: float
              example: 100.0
            width:
              type: number
              format: float
              example: 100.0
            height:
              type: number
              format: float
              example: 100.0
          description: Maximum dimensions in cm

    # Tariff Schemas
    TariffCalculationRequest:
      type: object
      required:
        - origin
        - destination
        - package
      properties:
        origin:
          $ref: '#/components/schemas/LocationPoint'
        destination:
          $ref: '#/components/schemas/LocationPoint'
        package:
          $ref: '#/components/schemas/PackageDetails'
        options:
          $ref: '#/components/schemas/TariffOptions'

    LocationPoint:
      type: object
      required:
        - area_id
      properties:
        province_id:
          type: string
        city_id:
          type: string
        area_id:
          type: string
        postal_code:
          type: string

    PackageDetails:
      type: object
      required:
        - weight
      properties:
        weight:
          type: number
          format: float
          description: Weight in kilograms
        length:
          type: number
          format: float
          description: Length in centimeters
        width:
          type: number
          format: float
          description: Width in centimeters
        height:
          type: number
          format: float
          description: Height in centimeters
        value:
          type: integer
          description: Package value in IDR
        category:
          type: string
          enum: ["electronics", "clothing", "books", "food", "fragile", "other"]

    TariffOptions:
      type: object
      properties:
        insurance:
          type: boolean
          default: false
        cod:
          type: boolean
          default: false
        express_only:
          type: boolean
          default: false

    TariffCalculationResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/TariffCalculationData'

    TariffCalculationData:
      type: object
      properties:
        calculation_id:
          type: string
        origin:
          $ref: '#/components/schemas/LocationInfo'
        destination:
          $ref: '#/components/schemas/LocationInfo'
        package:
          $ref: '#/components/schemas/PackageInfo'
        couriers:
          type: array
          items:
            $ref: '#/components/schemas/CourierOption'

    LocationInfo:
      type: object
      properties:
        province:
          type: string
        city:
          type: string
        area:
          type: string

    PackageInfo:
      type: object
      properties:
        weight:
          type: number
        dimensions:
          type: string
        value:
          type: integer

    CourierOption:
      type: object
      properties:
        courier_id:
          type: string
        courier_name:
          type: string
        services:
          type: array
          items:
            $ref: '#/components/schemas/CourierService'

    CourierService:
      type: object
      properties:
        service_id:
          type: string
        service_name:
          type: string
        price:
          type: integer
        estimated_delivery:
          type: string
        features:
          type: array
          items:
            type: string
        insurance:
          $ref: '#/components/schemas/InsuranceOption'

    InsuranceOption:
      type: object
      properties:
        available:
          type: boolean
        fee:
          type: integer
        coverage:
          type: integer

    # Courier Schemas
    CouriersResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                couriers:
                  type: array
                  items:
                    $ref: '#/components/schemas/Courier'

    Courier:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        logo_url:
          type: string
        active:
          type: boolean
        features:
          type: array
          items:
            type: string

    # Transaction Schemas
    TransactionCreateRequest:
      type: object
      required:
        - order_name
        - order_price
        - weight
        - courier
        - from
        - to
      properties:
        unique_id:
          type: string
          description: Unique identifier for idempotent requests
          example: "trans-12345-abc"
        order_name:
          type: string
          description: Name/description of the order
          example: "Electronics Package"
        order_price:
          type: number
          format: float
          description: Price of the ordered items
          example: 500000
        weight:
          type: integer
          description: Weight in grams
          example: 1000
        length:
          type: integer
          description: Length in cm
          example: 20
        width:
          type: integer
          description: Width in cm
          example: 15
        height:
          type: integer
          description: Height in cm
          example: 10
        notes:
          type: string
          description: Additional notes for delivery
          example: "Fragile items, handle with care"
        courier:
          type: string
          description: "Courier service code (note: JNE requires insurance)"
          enum: [jne, jnt, sicepat, ninja]
          example: "jne"
        courier_service_type:
          type: string
          description: Service type code for the courier
          example: "REG"
        pickup_method:
          type: string
          description: Pickup method for the shipment
          enum: [pickup, dropoff]
          example: "dropoff"
        platform:
          type: string
          description: Platform making the request
          enum: [web, android, ios]
          example: "web"
        with_insurance:
          type: boolean
          description: Whether to include shipping insurance (automatically calculated, mandatory for some couriers like JNE)
          example: true
        pickup_request_time:
          type: string
          format: date-time
          description: Requested pickup time
          example: "2025-05-16T09:00:00Z"
        cod:
          type: boolean
          description: Whether this is a COD transaction
          example: false
        cod_value:
          type: number
          format: float
          description: COD amount to collect (required when cod is true)
          example: 500000
        cod_admin_fee_paid_by:
          type: string
          description: Who pays the COD admin fee (required when cod is true)
          enum: [seller, buyer]
          example: "seller"
        package_category:
          type: string
          description: Category of the package contents
          enum: [Fashion, Dokumen, Buku, "Obat & Herbal", Kecantikan, Mainan, Makanan, "Makanan Beku", "Makanan Segar", Sparepart, "Alat Kesehatan"]
          example: "Fashion"
        from:
          $ref: '#/components/schemas/TransactionAddress'
        to:
          $ref: '#/components/schemas/TransactionAddress'
        ewallet_override_phone:
          type: string
          description: Override phone number for e-wallet payments (optional). If provided, this phone number will be used instead of the user's profile phone when creating e-wallet charges with DurianPay.
          example: "+6281234567890"
        payment_method:
          type: string
          description: Payment method for the booking. Defaults to API_CREDIT for B2B transactions.
          enum: [API_CREDIT, QRCODE, VA, EWALLET]
          example: "QRCODE"
        channel:
          type: string
          description: Specific payment channel (required when payment_method is not API_CREDIT)
          example: "QRIS"
        original_sender:
          $ref: '#/components/schemas/TransactionSender'
          description: Optional original sender details for dropshipping

    TransactionAddress:
      type: object
      required:
        - name
        - phone
        - province
        - city
        - address
        - post_code
      properties:
        name:
          type: string
          description: Recipient/sender name
          example: "John Doe"
        phone:
          type: string
          description: Contact phone number
          example: "081234567890"
        email:
          type: string
          format: email
          description: Contact email
          example: "john@example.com"
        address:
          type: string
          description: Street address
          example: "Jl. Sudirman No. 123"
        area:
          type: string
          description: Area/district/subdistrict
          example: "Karet Tengsin"
        city:
          type: string
          description: City
          example: "Jakarta Pusat"
        province:
          type: string
          description: Province
          example: "DKI Jakarta"
        post_code:
          type: string
          description: Postal code
          example: "10220"
        latitude:
          type: number
          format: float
          description: Latitude coordinate
          example: -6.2088
        longitude:
          type: number
          format: float
          description: Longitude coordinate
          example: 106.8456

    TransactionSender:
      type: object
      required:
        - name
        - phone
      properties:
        name:
          type: string
          description: Original sender name
          example: "Jane Smith"
        phone:
          type: string
          description: Original sender phone
          example: "087654321098"
        store_name:
          type: string
          description: Store name
          example: "JaneStore"

    BookingPackageDetails:
      type: object
      required:
        - description
        - weight
        - value
      properties:
        description:
          type: string
        weight:
          type: number
        dimensions:
          $ref: '#/components/schemas/Dimensions'
        value:
          type: integer
        category:
          type: string

    Dimensions:
      type: object
      properties:
        length:
          type: number
        width:
          type: number
        height:
          type: number

    BookingOptions:
      type: object
      properties:
        insurance:
          type: boolean
        cod:
          type: boolean
        pickup_required:
          type: boolean
        pickup_time:
          type: string
          enum: ["morning", "afternoon", "evening"]

    PaymentInfo:
      type: object
      properties:
        method:
          type: string
          enum: ["api_credit", "invoice", "prepaid"]
        reference:
          type: string

    BookingResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/BookingData'

    BookingData:
      type: object
      properties:
        booking_id:
          type: string
        tracking_number:
          type: string
        courier:
          type: string
        service:
          type: string
        status:
          type: string
        total_cost:
          type: integer
        breakdown:
          $ref: '#/components/schemas/CostBreakdown'
        payment:
          $ref: '#/components/schemas/PaymentStatus'
        estimated_pickup:
          type: string
          format: date-time
        estimated_delivery:
          type: string
          format: date-time

    CostBreakdown:
      type: object
      properties:
        shipping_fee:
          type: integer
        insurance_fee:
          type: integer
        admin_fee:
          type: integer

    PaymentStatus:
      type: object
      properties:
        status:
          type: string
        method:
          type: string
        invoice_id:
          type: string

    BookingDetailsResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/BookingDetails'

    BookingDetails:
      type: object
      properties:
        booking_id:
          type: string
        tracking_number:
          type: string
        status:
          type: string
        courier:
          $ref: '#/components/schemas/CourierInfo'
        sender:
          $ref: '#/components/schemas/ContactDetails'
        recipient:
          $ref: '#/components/schemas/ContactDetails'
        package:
          $ref: '#/components/schemas/PackageDetails'
        cost:
          $ref: '#/components/schemas/CostBreakdown'
        timeline:
          $ref: '#/components/schemas/BookingTimeline'

    CourierInfo:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        service:
          type: string

    ContactDetails:
      type: object
      properties:
        name:
          type: string
        phone:
          type: string
        email:
          type: string
        address:
          type: string

    BookingTimeline:
      type: object
      properties:
        created_at:
          type: string
          format: date-time
        confirmed_at:
          type: string
          format: date-time
        pickup_scheduled:
          type: string
          format: date-time
        estimated_delivery:
          type: string
          format: date-time

    BookingUpdateRequest:
      type: object
      properties:
        recipient:
          $ref: '#/components/schemas/ContactInfo'
        pickup_time:
          type: string

    # Payment Schemas
    PaymentInvoiceRequest:
      type: object
      required:
        - booking_ids
        - payment_method
      properties:
        booking_ids:
          type: array
          items:
            type: string
        payment_method:
          type: string
          enum: ["qr_code", "virtual_account", "credit_card", "e_wallet"]
        payment_channel:
          type: string
        customer_info:
          $ref: '#/components/schemas/CustomerInfo'

    CustomerInfo:
      type: object
      properties:
        name:
          type: string
        email:
          type: string
        phone:
          type: string

    PaymentInvoiceResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/PaymentInvoiceData'

    PaymentInvoiceData:
      type: object
      properties:
        invoice_id:
          type: string
        payment_url:
          type: string
        amount:
          type: integer
        status:
          type: string
        expires_at:
          type: string
          format: date-time

    # Tracking Schemas
    TrackingResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/TrackingData'

    TrackingData:
      type: object
      properties:
        tracking_number:
          type: string
        courier:
          type: string
        status:
          type: string
        current_location:
          type: string
        estimated_delivery:
          type: string
          format: date-time
        last_update:
          type: string
          format: date-time
        history:
          type: array
          items:
            $ref: '#/components/schemas/TrackingEvent'

    TrackingEvent:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        status:
          type: string
        location:
          type: string
        description:
          type: string

    BatchTrackingResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                results:
                  type: array
                  items:
                    $ref: '#/components/schemas/TrackingData'

    # Webhook Schemas
    WebhookRegistrationRequest:
      type: object
      required:
        - url
        - events
      properties:
        url:
          type: string
          format: uri
        events:
          type: array
          items:
            type: string
            enum: ["booking.created", "booking.confirmed", "payment.paid", "tracking.updated", "delivery.completed"]
        secret:
          type: string
          description: Secret for webhook signature verification

    # Booking Response Schema
    BookingResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/BookingData'

    BookingData:
      type: object
      properties:
        booking:
          $ref: '#/components/schemas/BookingInfo'
        transaction:
          $ref: '#/components/schemas/TransactionInfo'
          description: Transaction details (only present for non-API_CREDIT payments)
        invoice:
          $ref: '#/components/schemas/InvoiceInfo'
          description: Invoice details (only present for non-API_CREDIT payments)

    BookingInfo:
      type: object
      properties:
        id:
          type: string
          description: Booking ID
          example: "BKG-20240115-001"
        booking_id:
          type: string
          description: External booking ID
          example: "BKG-20240115-001"
        tracking_number:
          type: string
          description: Courier tracking number
          example: "JT123456789"
        courier_id:
          type: string
          description: Courier service ID
          example: "jnt"
        courier_name:
          type: string
          description: Courier service name
          example: "J&T Express"
        service_id:
          type: string
          description: Service type ID
          example: "REG"
        service_name:
          type: string
          description: Service type name
          example: "Regular"
        status:
          type: string
          description: Booking status
          example: "confirmed"
        total_cost:
          type: integer
          description: Total shipping cost in IDR
          example: 14500
        shipping_cost:
          type: integer
          description: Base shipping cost
          example: 12000
        insurance_cost:
          type: integer
          description: Insurance cost
          example: 2500
        cod_amount:
          type: integer
          description: COD amount if applicable
          example: 0
        estimated_pickup:
          type: string
          format: date-time
          description: Estimated pickup time
          example: "2024-01-16T09:00:00Z"
        estimated_delivery:
          type: string
          format: date-time
          description: Estimated delivery time
          example: "2024-01-18T17:00:00Z"
        created_at:
          type: string
          format: date-time
          description: Booking creation timestamp
          example: "2024-01-15T10:30:00Z"

    TransactionInfo:
      type: object
      properties:
        id:
          type: string
          description: Transaction ID
          example: "TXN-20240115-001"
        transaction_code:
          type: string
          description: Transaction code
          example: "TXN-20240115-001"
        amount:
          type: integer
          description: Transaction amount in IDR
          example: 14500
        status:
          type: string
          description: Transaction status
          enum: ["pending", "paid", "failed", "expired"]
          example: "pending"
        payment_method:
          type: string
          description: Payment method used
          example: "QRCODE"
        channel:
          type: string
          description: Payment channel
          example: "QRIS"
        created_at:
          type: string
          format: date-time
          description: Transaction creation timestamp
          example: "2024-01-15T10:30:00Z"

    InvoiceInfo:
      type: object
      properties:
        id:
          type: string
          description: Invoice ID
          example: "INV-2024-001"
        invoice_url:
          type: string
          description: Payment URL for QR/VA payments
          example: "https://payment.example.com/invoice/INV-2024-001"
        qr_code:
          type: string
          description: QR code data for QRIS payments
          example: "00020101021226..."
        amount:
          type: integer
          description: Invoice amount in IDR
          example: 14500
        status:
          type: string
          description: Invoice payment status
          enum: ["pending", "paid", "expired", "cancelled"]
          example: "pending"
        expires_at:
          type: string
          format: date-time
          description: Invoice expiry time
          example: "2024-01-15T22:30:00Z"
        created_at:
          type: string
          format: date-time
          description: Invoice creation timestamp
          example: "2024-01-15T10:30:00Z"

    # Transaction Response Schema
    TransactionResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/TransactionData'

    TransactionData:
      type: object
      properties:
        id:
          type: string
          description: Transaction ID
          example: "TXN-20240115-001"
        unique_id:
          type: string
          description: Client-provided unique identifier
          example: "trans-b2b-123456"
        order_name:
          type: string
          description: Order name or description
          example: "Electronics - Laptop"
        order_price:
          type: integer
          description: Order value in IDR
          example: 500000
        weight:
          type: integer
          description: Package weight in grams
          example: 1500
        dimensions:
          type: object
          properties:
            length:
              type: integer
              description: Package length in cm
              example: 20
            width:
              type: integer
              description: Package width in cm
              example: 15
            height:
              type: integer
              description: Package height in cm
              example: 10
        notes:
          type: string
          description: Special instructions or notes
          example: "Fragile items, handle with care"
        courier:
          type: string
          description: Selected courier
          example: "jnt"
        courier_service_type:
          type: string
          description: Courier service type
          example: "REG"
        pickup_method:
          type: string
          description: Pickup method
          enum: ["pickup", "drop_off"]
          example: "pickup"
        platform:
          type: string
          description: Platform source
          example: "web"
        with_insurance:
          type: boolean
          description: Whether insurance is included
          example: true
        cod:
          type: boolean
          description: Whether cash on delivery is enabled
          example: false
        package_category:
          type: string
          description: Package category
          example: "Fashion"
        status:
          type: string
          description: Transaction status
          example: "confirmed"
        tracking_number:
          type: string
          description: Tracking number from courier
          example: "JT123456789"
        total_cost:
          type: integer
          description: Total shipping cost in IDR
          example: 14500
        breakdown:
          type: object
          properties:
            shipping_fee:
              type: integer
              description: Base shipping fee
              example: 12000
            insurance_fee:
              type: integer
              description: Insurance fee
              example: 2500
            admin_fee:
              type: integer
              description: Administrative fee
              example: 0
        payment:
          type: object
          properties:
            status:
              type: string
              description: Payment status
              example: "paid"
            method:
              type: string
              description: Payment method
              example: "api_credit"
            invoice_id:
              type: string
              description: Invoice ID if applicable
              example: "INV-2024-001"
        sender:
          $ref: '#/components/schemas/TransactionAddress'
        recipient:
          $ref: '#/components/schemas/TransactionAddress'
        estimated_pickup:
          type: string
          format: date-time
          description: Estimated pickup time
          example: "2024-01-16T09:00:00Z"
        estimated_delivery:
          type: string
          format: date-time
          description: Estimated delivery time
          example: "2024-01-18T17:00:00Z"
        created_at:
          type: string
          format: date-time
          description: Transaction creation timestamp
          example: "2024-01-15T10:30:00Z"
        updated_at:
          type: string
          format: date-time
          description: Transaction last update timestamp
          example: "2024-01-15T10:30:00Z"

    # Invoice Response Schema
    InvoiceResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/InvoiceData'

    InvoiceData:
      type: object
      properties:
        id:
          type: string
          description: Invoice ID
          example: "INV-2024-001"
        type:
          type: string
          description: Invoice type
          enum: ["single", "consolidated"]
          example: "single"
        status:
          type: string
          description: Invoice payment status
          enum: ["pending", "paid", "expired", "cancelled"]
          example: "paid"
        amount:
          type: integer
          description: Total invoice amount in IDR
          example: 14500
        currency:
          type: string
          description: Currency code
          example: "IDR"
        payment_method:
          type: string
          description: Payment method used
          example: "api_credit"
        payment_date:
          type: string
          format: date-time
          description: Payment completion timestamp
          example: "2024-01-15T11:00:00Z"
        due_date:
          type: string
          format: date-time
          description: Invoice due date
          example: "2024-01-22T23:59:59Z"
        transaction_ids:
          type: array
          items:
            type: string
          description: List of transaction IDs included in this invoice
          example: ["TXN-20240115-001"]
        breakdown:
          type: object
          properties:
            shipping_fee:
              type: integer
              description: Total shipping fees
              example: 12000
            insurance_fee:
              type: integer
              description: Total insurance fees
              example: 2500
            admin_fee:
              type: integer
              description: Total administrative fees
              example: 0
            total:
              type: integer
              description: Total amount
              example: 14500
        client:
          type: object
          properties:
            id:
              type: string
              description: B2B client ID
              example: "client_123"
            name:
              type: string
              description: B2B client name
              example: "PT. Example Company"
        created_at:
          type: string
          format: date-time
          description: Invoice creation timestamp
          example: "2024-01-15T10:30:00Z"
        updated_at:
          type: string
          format: date-time
          description: Invoice last update timestamp
          example: "2024-01-15T11:00:00Z"

  responses:
    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/BaseResponse'
              - type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  errors:
                    type: array
                    items:
                      type: object
                      properties:
                        code:
                          type: string
                          example: "UNAUTHORIZED"
                        message:
                          type: string
                          example: "Invalid or missing API key"

    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/BaseResponse'
              - type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  errors:
                    type: array
                    items:
                      $ref: '#/components/schemas/ErrorDetail'

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/BaseResponse'
              - type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  errors:
                    type: array
                    items:
                      type: object
                      properties:
                        code:
                          type: string
                          example: "NOT_FOUND"
                        message:
                          type: string
                          example: "Resource not found"

    RateLimitExceeded:
      description: Rate limit exceeded
      headers:
        X-RateLimit-Remaining:
          description: Requests remaining in current window
          schema:
            type: integer
        X-RateLimit-Reset:
          description: Unix timestamp when rate limit resets
          schema:
            type: integer
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/BaseResponse'
              - type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  errors:
                    type: array
                    items:
                      type: object
                      properties:
                        code:
                          type: string
                          example: "RATE_LIMIT_EXCEEDED"
                        message:
                          type: string
                          example: "Rate limit exceeded. Try again later."

tags:
  - name: Location Services
    description: Geographic location and address management
  - name: Tariff & Pricing
    description: Shipping cost calculation and courier comparison
  - name: Courier Services
    description: Available courier and service information
  - name: Booking Management
    description: Shipment booking and management
  - name: Transaction Management
    description: Transaction retrieval and management
  - name: Payment Services
    description: Payment processing and invoice management
  - name: Tracking Services
    description: Real-time shipment tracking
  - name: Webhook Management
    description: Webhook registration and management