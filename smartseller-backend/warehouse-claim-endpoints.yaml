openapi: 3.0.0
info:
  title: SmartSeller Warehouse API
  description: Warehouse admin endpoints for managing warranty claims in post-repair stages
  version: 1.0.0

paths:
  /api/v1/warehouse/claims:
    get:
      tags:
        - Warehouse Claims
      summary: List warehouse claims
      description: |
        Get paginated list of warranty claims in warehouse processing stages.
        
        **Warehouse Stages:**
        - **repaired**: Repair completed, awaiting shipment
        - **shipped**: Product shipped back to customer
        - **delivered**: Product delivered to customer
        - **completed**: Claim closed successfully
        
        **Access**: Requires warehouse_admin role or owner/admin permissions
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          required: false
          description: Page number
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: page_size
          in: query
          required: false
          description: Number of items per page
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
        - name: sort_by
          in: query
          required: false
          description: Field to sort by
          schema:
            type: string
            default: created_at
            enum: [created_at, updated_at, status, priority, claim_number]
        - name: sort_dir
          in: query
          required: false
          description: Sort direction
          schema:
            type: string
            default: desc
            enum: [asc, desc]
        - name: status
          in: query
          required: false
          description: Filter by warehouse status
          schema:
            type: string
            enum: [repaired, shipped, delivered, completed]
        - name: search
          in: query
          required: false
          description: Search in claim number, customer name, or description
          schema:
            type: string
      responses:
        '200':
          description: Claims retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Warehouse claims retrieved successfully"
                  data:
                    type: object
                    properties:
                      claims:
                        type: array
                        items:
                          $ref: './warranty-schemas.yaml'./schemas.yaml#/schemas/WarrantyClaimDTO'
                      pagination:
                        type: object
                        properties:
                          page:
                            type: integer
                            example: 1
                          limit:
                            type: integer
                            example: 20
                          total:
                            type: integer
                            example: 45
                          total_pages:
                            type: integer
                            example: 3
                          has_next:
                            type: boolean
                            example: true
                          has_prev:
                            type: boolean
                            example: false
                      filters:
                        type: object
                        properties:
                          available_statuses:
                            type: array
                            items:
                              type: string
                            example: ["repaired", "shipped", "delivered", "completed"]
              examples:
                allClaims:
                  summary: All warehouse claims
                  value:
                    success: true
                    message: "Warehouse claims retrieved successfully"
                    data:
                      claims:
                        - id: "550e8400-e29b-41d4-a716-446655440000"
                          claim_number: "WC-2024-001234"
                          status: "repaired"
                          customer_name: "John Doe"
                          customer_email: "john@example.com"
                          issue_description: "Screen not working"
                          created_at: "2024-11-15T10:00:00Z"
                          updated_at: "2024-11-18T14:30:00Z"
                        - id: "550e8400-e29b-41d4-a716-446655440001"
                          claim_number: "WC-2024-001235"
                          status: "shipped"
                          customer_name: "Jane Smith"
                          customer_email: "jane@example.com"
                          issue_description: "Battery issue"
                          created_at: "2024-11-14T09:00:00Z"
                          updated_at: "2024-11-17T16:00:00Z"
                      pagination:
                        page: 1
                        limit: 20
                        total: 45
                        total_pages: 3
                        has_next: true
                        has_prev: false
                      filters:
                        available_statuses: ["repaired", "shipped", "delivered", "completed"]
                
                repairedOnly:
                  summary: Filter by repaired status
                  value:
                    success: true
                    message: "Warehouse claims retrieved successfully"
                    data:
                      claims:
                        - id: "550e8400-e29b-41d4-a716-446655440000"
                          claim_number: "WC-2024-001234"
                          status: "repaired"
                          customer_name: "John Doe"
                          issue_description: "Screen not working"
                          created_at: "2024-11-15T10:00:00Z"
                      pagination:
                        page: 1
                        limit: 20
                        total: 12
                        total_pages: 1
                        has_next: false
                        has_prev: false
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/warehouse/claims/{id}:
    get:
      tags:
        - Warehouse Claims
      summary: Get claim details
      description: Get detailed information about a specific warranty claim
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Warranty claim ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Claim retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Warranty claim retrieved successfully"
                  data:
                    $ref: './warranty-schemas.yaml'./schemas.yaml#/schemas/WarrantyClaimDTO'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/warehouse/claims/{id}/status:
    put:
      tags:
        - Warehouse Claims
      summary: Update claim status
      description: |
        Update the status of a warranty claim in warehouse processing.
        
        **Allowed transitions:**
        - repaired → shipped (when product is dispatched)
        - shipped → delivered (when delivery confirmed)
        - delivered → completed (when customer confirms receipt)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Warranty claim ID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './warranty-schemas.yaml'./schemas.yaml#/schemas/UpdateClaimRequest'
            examples:
              markShipped:
                summary: Mark as shipped
                value:
                  status: "shipped"
                  notes: "Product shipped via JNE Express. Tracking: JNE123456789"
              markDelivered:
                summary: Mark as delivered
                value:
                  status: "delivered"
                  notes: "Product delivered successfully. Signed by customer."
              markCompleted:
                summary: Mark as completed
                value:
                  status: "completed"
                  notes: "Customer confirmed receipt and satisfaction. Claim closed."
      responses:
        '200':
          description: Status updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Warranty claim status updated successfully"
                  data:
                    $ref: './warranty-schemas.yaml'./schemas.yaml#/schemas/WarrantyClaimDTO'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  responses:
    Unauthorized:
      description: Unauthorized - Authentication required
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              message:
                type: string
                example: "Authentication required"

    Forbidden:
      description: Forbidden - Insufficient permissions
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              message:
                type: string
                example: "Insufficient permissions"

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              message:
                type: string
                example: "Resource not found"

    BadRequest:
      description: Bad request - Invalid input
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              message:
                type: string
                example: "Invalid request"

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              message:
                type: string
                example: "Internal server error"
