schemas:
  # Shopping Cart Schemas
  ShoppingCartDTO:
    type: object
    properties:
      id:
        type: string
        format: uuid
        example: "123e4567-e89b-12d3-a456-426614174000"
      storefront_id:
        type: string
        format: uuid
        example: "456e7890-e89b-12d3-a456-426614174000"
      customer_id:
        type: string
        format: uuid
        nullable: true
        example: "789e0123-e89b-12d3-a456-426614174000"
      session_id:
        type: string
        nullable: true
        example: "guest_session_123456"
      cart_type:
        type: string
        enum: [customer, guest]
        example: "customer"
      items:
        type: array
        items:
          $ref: '#/components/schemas/CartItemDTO'
      total_amount:
        type: number
        format: decimal
        example: 150000.00
      total_items:
        type: integer
        example: 3
      coupon_code:
        type: string
        nullable: true
        example: "SAVE20"
      discount_amount:
        type: number
        format: decimal
        example: 30000.00
      final_amount:
        type: number
        format: decimal
        example: 120000.00
      created_at:
        type: string
        format: date-time
        example: "2023-05-31T14:30:00Z"
      updated_at:
        type: string
        format: date-time
        example: "2023-05-31T14:30:00Z"

  CartItemDTO:
    type: object
    properties:
      id:
        type: string
        format: uuid
        example: "123e4567-e89b-12d3-a456-426614174000"
      cart_id:
        type: string
        format: uuid
        example: "456e7890-e89b-12d3-a456-426614174000"
      product_id:
        type: string
        format: uuid
        example: "789e0123-e89b-12d3-a456-426614174000"
      product_variant_id:
        type: string
        format: uuid
        nullable: true
        example: "012e3456-e89b-12d3-a456-426614174000"
      quantity:
        type: integer
        minimum: 1
        example: 2
      unit_price:
        type: number
        format: decimal
        example: 50000.00
      total_price:
        type: number
        format: decimal
        example: 100000.00
      product:
        $ref: '#/components/schemas/ProductSummaryDTO'
      product_variant:
        $ref: '#/components/schemas/ProductVariantSummaryDTO'
      created_at:
        type: string
        format: date-time
        example: "2023-05-31T14:30:00Z"
      updated_at:
        type: string
        format: date-time
        example: "2023-05-31T14:30:00Z"

  ProductSummaryDTO:
    type: object
    description: |
      Summary information about a product included in order items.
      This is populated when include_items=true in order list requests.
    properties:
      id:
        type: string
        format: uuid
        example: "789e0123-e89b-12d3-a456-426614174000"
      name:
        type: string
        example: "Premium Wireless Headphones"
      sku:
        type: string
        example: "PWH-001"
      description:
        type: string
        nullable: true
        example: "High-quality wireless headphones with noise cancellation"
      image_url:
        type: string
        format: uri
        nullable: true
        example: "https://example.com/images/headphones.jpg"
        description: |
          Primary product image URL. If no image is marked as primary,
          the first image URL is returned. Null if product has no images.

  ProductVariantSummaryDTO:
    type: object
    description: |
      Summary information about a product variant included in order items.
      This is populated when include_items=true and the item has a variant.
    properties:
      id:
        type: string
        format: uuid
        example: "012e3456-e89b-12d3-a456-426614174000"
      name:
        type: string
        nullable: true
        example: "Black - Large"
      sku:
        type: string
        nullable: true
        example: "PWH-001-BLK-L"
      attributes:
        type: object
        nullable: true
        additionalProperties: true
        example:
          color: "Black"
          size: "Large"
        description: |
          Variant options as key-value pairs (e.g., color, size).
          Format depends on product configuration.

  # Order Schemas
  OrderDTO:
    type: object
    properties:
      id:
        type: string
        format: uuid
        example: "123e4567-e89b-12d3-a456-426614174000"
      order_number:
        type: string
        example: "ORD-2023-001234"
      storefront_id:
        type: string
        format: uuid
        example: "456e7890-e89b-12d3-a456-426614174000"
      customer_id:
        type: string
        format: uuid
        example: "789e0123-e89b-12d3-a456-426614174000"
      status:
        type: string
        enum: [pending, confirmed, processing, shipped, delivered, completed, cancelled, refunded]
        example: "pending"
      payment_status:
        type: string
        enum: [pending, paid, failed, refunded]
        example: "pending"
      payment_method:
        type: string
        enum: [credit_card, bank_transfer, e_wallet, cod]
        example: "credit_card"
      subtotal:
        type: number
        format: decimal
        example: 150000.00
      discount_amount:
        type: number
        format: decimal
        example: 30000.00
      shipping_cost:
        type: number
        format: decimal
        example: 15000.00
      tax_amount:
        type: number
        format: decimal
        example: 13500.00
      total_amount:
        type: number
        format: decimal
        example: 148500.00
      currency:
        type: string
        example: "IDR"
      shipping_address:
        $ref: '#/components/schemas/AddressDTO'
      billing_address:
        $ref: '#/components/schemas/AddressDTO'
      items:
        type: array
        items:
          $ref: '#/components/schemas/OrderItemDTO'
      notes:
        type: string
        nullable: true
        example: "Please handle with care"
      tracking_number:
        type: string
        nullable: true
        example: "TRK123456789"
      shipped_at:
        type: string
        format: date-time
        nullable: true
        example: "2023-06-01T10:00:00Z"
      delivered_at:
        type: string
        format: date-time
        nullable: true
        example: "2023-06-03T14:30:00Z"
      created_at:
        type: string
        format: date-time
        example: "2023-05-31T14:30:00Z"
      updated_at:
        type: string
        format: date-time
        example: "2023-05-31T14:30:00Z"

  OrderItemDTO:
    type: object
    description: |
      Order item with optional product and variant details.
      The product and product_variant fields are populated when include_items=true.
    properties:
      id:
        type: string
        format: uuid
        example: "123e4567-e89b-12d3-a456-426614174000"
      order_id:
        type: string
        format: uuid
        example: "456e7890-e89b-12d3-a456-426614174000"
      product_id:
        type: string
        format: uuid
        example: "789e0123-e89b-12d3-a456-426614174000"
      product_variant_id:
        type: string
        format: uuid
        nullable: true
        example: "012e3456-e89b-12d3-a456-426614174000"
      quantity:
        type: integer
        minimum: 1
        example: 2
      unit_price:
        type: number
        format: decimal
        example: 50000.00
      total_price:
        type: number
        format: decimal
        example: 100000.00
      product:
        description: |
          Product details (id, name, sku, description, image_url).
          Only populated when include_items=true in the request.
          Null if product has been deleted.
        nullable: true
        $ref: '#/components/schemas/ProductSummaryDTO'
      product_variant:
        description: |
          Product variant details (id, name, sku, attributes).
          Only populated when include_items=true and the item has a variant.
          Null if the variant has been deleted or the item has no variant.
        nullable: true
        $ref: '#/components/schemas/ProductVariantSummaryDTO'

  AddressDTO:
    type: object
    properties:
      id:
        type: string
        format: uuid
        example: "123e4567-e89b-12d3-a456-426614174000"
      name:
        type: string
        example: "John Doe"
      phone:
        type: string
        example: "+6281234567890"
      email:
        type: string
        format: email
        nullable: true
        example: "john.doe@example.com"
      address_line_1:
        type: string
        example: "Jl. Sudirman No. 123"
      address_line_2:
        type: string
        nullable: true
        example: "Apt 4B"
      city:
        type: string
        example: "Jakarta"
      state:
        type: string
        example: "DKI Jakarta"
      postal_code:
        type: string
        example: "12190"
      country:
        type: string
        example: "Indonesia"
      is_default:
        type: boolean
        example: true

  # Request/Response DTOs
  AddToCartRequest:
    type: object
    required:
      - product_id
      - quantity
    properties:
      product_id:
        type: string
        format: uuid
        example: "789e0123-e89b-12d3-a456-426614174000"
      product_variant_id:
        type: string
        format: uuid
        nullable: true
        example: "012e3456-e89b-12d3-a456-426614174000"
      quantity:
        type: integer
        minimum: 1
        example: 2

  UpdateCartItemRequest:
    type: object
    required:
      - quantity
    properties:
      quantity:
        type: integer
        minimum: 0
        example: 3

  ApplyCouponRequest:
    type: object
    required:
      - coupon_code
    properties:
      coupon_code:
        type: string
        example: "SAVE20"

  CreateOrderRequest:
    type: object
    required:
      - shipping_address
      - payment_method
    properties:
      shipping_address:
        $ref: '#/components/schemas/AddressDTO'
      billing_address:
        $ref: '#/components/schemas/AddressDTO'
      payment_method:
        type: string
        enum: [credit_card, bank_transfer, e_wallet, cod]
        example: "credit_card"
      notes:
        type: string
        nullable: true
        example: "Please handle with care"
      coupon_code:
        type: string
        nullable: true
        example: "SAVE20"

  UpdateOrderStatusRequest:
    type: object
    required:
      - status
    properties:
      status:
        type: string
        enum: [confirmed, processing, shipped, delivered, completed, cancelled]
        example: "confirmed"
      tracking_number:
        type: string
        nullable: true
        example: "TRK123456789"
      notes:
        type: string
        nullable: true
        example: "Order confirmed and being processed"

  # Admin Order Item Request DTOs
  AddOrderItemRequest:
    type: object
    required:
      - product_id
      - quantity
    properties:
      product_id:
        type: string
        format: uuid
        example: "789e0123-e89b-12d3-a456-426614174000"
      variant_id:
        type: string
        format: uuid
        nullable: true
        example: "012e3456-e89b-12d3-a456-426614174000"
      quantity:
        type: integer
        minimum: 1
        example: 2
      unit_price:
        type: number
        format: decimal
        nullable: true
        example: 50000.00
      notes:
        type: string
        nullable: true
        example: "Add as promotional item"

  UpdateOrderItemRequest:
    type: object
    properties:
      quantity:
        type: integer
        minimum: 1
        example: 3
      unit_price:
        type: number
        format: decimal
        example: 55000.00
      notes:
        type: string
        nullable: true
        example: "Adjust quantity per customer request"

  # Admin Create Order DTOs
  AdminCreateOrderItemRequest:
    type: object
    required:
      - product_id
      - quantity
    properties:
      product_id:
        type: string
        format: uuid
        example: "789e0123-e89b-12d3-a456-426614174000"
      variant_id:
        type: string
        format: uuid
        nullable: true
        example: "012e3456-e89b-12d3-a456-426614174000"
      quantity:
        type: integer
        minimum: 1
        example: 2
      unit_price:
        type: number
        format: decimal
        nullable: true
        example: 50000.00
      notes:
        type: string
        nullable: true
        example: "Add as promotional item"

  AdminCreateOrderRequest:
    type: object
    required:
      - storefront_id
      - payment_method
      - items
      - shipping_address
    oneOf:
      - required: [customer_id]
      - required: [customer_email]
    properties:
      storefront_id:
        type: string
        format: uuid
        description: Storefront context for multi-tenant scoping
        example: "456e7890-e89b-12d3-a456-426614174000"
      customer_id:
        type: string
        format: uuid
        nullable: true
        description: Optional customer association (guest order if omitted)
        example: "789e0123-e89b-12d3-a456-426614174000"
      customer_email:
        type: string
        format: email
        nullable: true
        description: Customer email used when creating guest orders or overriding snapshot
        example: "john.doe@example.com"
      customer_phone:
        type: string
        nullable: true
        description: Optional customer phone used for contact or snapshot
        pattern: '^\+?[0-9\s\-()]{7,}$'
        example: "+6281234567890"
      payment_method:
        type: string
        enum: [credit_card, bank_transfer, e_wallet, cod]
        example: "bank_transfer"
      currency:
        type: string
        description: Optional ISO 4217 currency code (3 letters). Defaults to storefront currency.
        pattern: "^[A-Z]{3}$"
        example: "IDR"
      shipping_address:
        $ref: '#/components/schemas/AddressDTO'
      billing_address:
        $ref: '#/components/schemas/AddressDTO'
      items:
        type: array
        minItems: 1
        items:
          $ref: '#/schemas/AdminCreateOrderItemRequest'
      shipping_cost:
        type: number
        format: decimal
        nullable: true
        example: 15000.00
      tax_amount:
        type: number
        format: decimal
        nullable: true
        example: 13500.00
      discount_amount:
        type: number
        format: decimal
        nullable: true
        example: 30000.00
      coupon_code:
        type: string
        nullable: true
        example: "SAVE20"
      notes:
        type: string
        nullable: true
        example: "Create order for VIP customer"

  # List Response DTOs
  CartListResponse:
    type: object
    properties:
      success:
        type: boolean
        example: true
      message:
        type: string
        example: "Cart retrieved successfully"
      data:
        $ref: '#/components/schemas/ShoppingCartDTO'
      meta:
        type: object
        properties:
          http_status:
            type: integer
            example: 200

  OrderListResponse:
    type: object
    properties:
      success:
        type: boolean
        example: true
      message:
        type: string
        example: "Orders retrieved successfully"
      data:
        type: array
        items:
          $ref: '#/components/schemas/OrderDTO'
      pagination:
        $ref: '#/components/schemas/PaginationResponse'
      meta:
        type: object
        properties:
          http_status:
            type: integer
            example: 200

  OrderResponse:
    type: object
    properties:
      success:
        type: boolean
        example: true
      message:
        type: string
        example: "Order retrieved successfully"
      data:
        $ref: '#/components/schemas/OrderDTO'
      meta:
        type: object
        properties:
          http_status:
            type: integer
            example: 200

  PaginationResponse:
    type: object
    properties:
      page:
        type: integer
        example: 1
      page_size:
        type: integer
        example: 20
      total_items:
        type: integer
        example: 150
      total_pages:
        type: integer
        example: 8
      has_next:
        type: boolean
        example: true
      has_prev:
        type: boolean
        example: false